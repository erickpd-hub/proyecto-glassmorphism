<section class="container mx-auto px-4 py-20">
  <div class="text-center mb-12">
    {% if section.settings.title != blank %}
      <h2 class="text-4xl md:text-5xl text-gray-900 dark:text-white mb-4">
        {{ section.settings.title }}
      </h2>
    {% endif %}
    {% if section.settings.description != blank %}
      <p class="text-xl text-gray-700 dark:text-gray-300">
        {{ section.settings.description }}
      </p>
    {% endif %}
  </div>

  <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
    {% for block in section.blocks %}
      <div class="group bg-white/40 dark:bg-black/40 backdrop-blur-lg rounded-2xl overflow-hidden border border-white/50 dark:border-white/10 shadow-xl hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 aspect-square">
        {% if block.settings.image != blank %}
          <img src="{{ block.settings.image | img_url: '600x600' }}" 
               alt="{{ block.settings.caption }}"
               loading="lazy"
               class="w-full h-full object-cover group-hover:scale-110 transition-transform duration-500 cursor-pointer"
               onclick="openGalleryModal{{ section.id }}({{ forloop.index0 }})">
        {% else %}
          {{ 'image' | placeholder_svg_tag: 'w-full h-full object-cover' }}
        {% endif %}
      </div>
    {% endfor %}
  </div>
</section>

<!-- Gallery Modal -->
<div id="gallery-modal-{{ section.id }}" class="hidden fixed inset-0 bg-black/90 z-50 flex items-center justify-center p-4" onclick="closeGalleryModal{{ section.id }}()">
  <button onclick="closeGalleryModal{{ section.id }}()" class="absolute top-4 right-4 text-white hover:text-gray-300 transition-colors">
    <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
    </svg>
  </button>
  
  <button onclick="event.stopPropagation(); prevImage{{ section.id }}()" class="absolute left-4 text-white hover:text-gray-300 transition-colors">
    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
    </svg>
  </button>
  
  <div class="max-w-4xl w-full" onclick="event.stopPropagation()">
    <img id="gallery-image-{{ section.id }}" src="" alt="" class="w-full h-auto rounded-2xl">
  </div>
  
  <button onclick="event.stopPropagation(); nextImage{{ section.id }}()" class="absolute right-4 text-white hover:text-gray-300 transition-colors">
    <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
    </svg>
  </button>
</div>

<script>
  const galleryImages{{ section.id }} = [
    {% for block in section.blocks %}
      {% if block.settings.image != blank %}
        "{{ block.settings.image | img_url: '1200x1200' }}"{% unless forloop.last %},{% endunless %}
      {% endif %}
    {% endfor %}
  ];
  
  let currentImageIndex{{ section.id }} = 0;
  
  function openGalleryModal{{ section.id }}(index) {
    currentImageIndex{{ section.id }} = index;
    document.getElementById('gallery-image-{{ section.id }}').src = galleryImages{{ section.id }}[index];
    document.getElementById('gallery-modal-{{ section.id }}').classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  }
  
  function closeGalleryModal{{ section.id }}() {
    document.getElementById('gallery-modal-{{ section.id }}').classList.add('hidden');
    document.body.style.overflow = '';
  }
  
  function nextImage{{ section.id }}() {
    currentImageIndex{{ section.id }} = (currentImageIndex{{ section.id }} + 1) % galleryImages{{ section.id }}.length;
    document.getElementById('gallery-image-{{ section.id }}').src = galleryImages{{ section.id }}[currentImageIndex{{ section.id }}];
  }
  
  function prevImage{{ section.id }}() {
    currentImageIndex{{ section.id }} = (currentImageIndex{{ section.id }} - 1 + galleryImages{{ section.id }}.length) % galleryImages{{ section.id }}.length;
    document.getElementById('gallery-image-{{ section.id }}').src = galleryImages{{ section.id }}[currentImageIndex{{ section.id }}];
  }
</script>

{% schema %}
{
  "name": "Gallery",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "GALER√çA"
    },
    {
      "type": "text",
      "id": "description",
      "label": "Description"
    }
  ],
  "blocks": [
    {
      "type": "image",
      "name": "Image",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "caption",
          "label": "Caption"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Gallery",
      "blocks": [
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" },
        { "type": "image" }
      ]
    }
  ]
}
{% endschema %}
